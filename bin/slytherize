<?php

/**
 * Creates a series of directories
 */

$directories = array(
	'app/',
	'app/config/',
	'app/controllers/',
	'app/libraries/',
	'app/models/',
	'app/views/'
);

foreach ($directories as $directory) {
	if ( ! file_exists($directory)) {
		mkdir($directory);
	}
}

/**
 * Create the "Welcome" controller and view files
 */

if ( ! file_exists('app/controllers/Welcome.php')) {
	$welcome =
'<?php namespace Controllers;

use Slytherin\Controller;
use Slytherin\View;

/**
 * Welcome Controller Class
 */

class Welcome extends Controller {

	public function index()
	{
		return View::render(\'welcome/index\');
	}

}';

	$file = fopen('app/controllers/Welcome.php', 'wb');
	file_put_contents('app/controllers/Welcome.php', $welcome);
	fclose($file);
}

if ( ! file_exists('app/views/welcome/')) {
	mkdir('app/views/welcome/');

	$welcomeIndex =
'<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Slytherin</title>
</head>
<body>
	Hello there, wizard!
</body>
</html>';

	$file = fopen('app/views/welcome/index.php', 'wb');
	file_put_contents('app/views/welcome/index.php', $welcomeIndex);
	fclose($file);
}

/**
 * Creates a .htacess for clean urls
 */

$htaccess =
'RewriteEngine on
Options +FollowSymLinks
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule .* index.php/$0 [PT,L]';

$file = fopen('.htaccess', 'wb');
chmod('.htaccess', 0777);
file_put_contents('.htaccess', $htaccess);
fclose($file);

/**
 * Creates an index.php as the centralized entry point for handling requests
 */

if ( ! file_exists('index.php')) {
	$index =
'<?php

/**
 * Load the Composer Autoloader
 */

include \'vendor/autoload.php\';

/**
 * Import the Slytherin namespace
 */

use Slytherin\Application;
use Slytherin\Config;

/**
 * Load Pux\'s Mux (https://github.com/c9s/Pux)
 */

$route = new \Pux\Mux();

/**
 * Initialize and Run Slytherin
 */

$app = new Application($route);
$app->run();';

	$file = fopen('index.php', 'wb');
	chmod('index.php', 0777);
	file_put_contents('index.php', $index);
	fclose($file);
}

/**
 * Create a database.php for storing the database credentials
 */

if ( ! file_exists('app/config/database.php')) {
	$database =
'<?php

/**
 * Database Configuration
 * 
 * This is where you will setup your database credentials that
 * will be used by Slytherin\Model class. Take note that it will
 * use the PDO driver that is already included in PHP.
 */

return array(
	\'hostname\' => \'localhost\',
	\'username\' => \'root\',
	\'password\' => \'\',
	\'database\' => \'\',
	\'driver\'   => \'mysql\'
);';

	$file = fopen('app/config/database.php', 'wb');
	file_put_contents('app/config/database.php', $database);
	fclose($file);
}

/**
 * Create a routes.php for handling the user specified routes
 */

if ( ! file_exists('app/config/routes.php')) {
	$routes =
'<?php

/**
 * Application Routes
 * 
 * Here is where you can register all of the routes for an application.
 * If your controller has one or more of the following methods: 
 * 	create(), destroy(), edit(), index(), show(), store(), and update()
 * You don\'t need to include them here, the routing for them is already done by Slytherin.
 */

/**
 * Default controller
 */

$route->any(\'/\', \'Controllers\\\\Welcome:index\');';

	$file = fopen('app/config/routes.php', 'wb');
	file_put_contents('app/config/routes.php', $routes);
	fclose($file);
}

echo 'Slytherin is now properly setup!' . PHP_EOL;